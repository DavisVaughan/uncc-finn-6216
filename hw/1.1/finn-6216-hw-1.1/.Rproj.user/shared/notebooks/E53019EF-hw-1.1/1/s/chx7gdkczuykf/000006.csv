"0","aapl_rel_dg_numerical <- aapl_rel %>%"
"0","  na.omit() %>%"
"0","  mutate("
"0","    # Calculate h for absolute"
"0","    h                = sqrt(var(delta_close / close) + mean(delta_close / close) ^ 2),"
"0","    # Recalculate the put options with a shock upward"
"0","    shift_up_close   = put_option_pricer(current_close_aapl + h * current_close_aapl, k, r, y, time_to_expiry, sigma),"
"0","    # Recalculate the put options with a shock downward"
"0","    shift_down_close = put_option_pricer(current_close_aapl - h * current_close_aapl, k, r, y, time_to_expiry, sigma),"
"0","    # This is P in the formula, used by gamma"
"0","    no_shift_close   = put_option_pricer(current_close_aapl, k, r, y, time_to_expiry, sigma),"
"0","    # Approximate delta"
"0","    delta_numerical  = (shift_up_close - shift_down_close) / (2 * h * current_close_aapl),"
"0","    # Approximate gamma"
"0","    gamma_numerical  = (shift_up_close - 2 * no_shift_close + shift_down_close) / ((h * current_close_aapl)^2),"
"0","    # Calculate delta_p from numerical delta/gamma"
"0","    delta_p          = delta_numerical * delta_close + 1/2 * gamma_numerical * delta_close ^ 2"
"0","  )"
"0","# This is h"
"0","aapl_rel_dg_numerical$h[1]"
"1","[1]"
"1"," 0.01702135"
"1","
"
"0","# Here are the shifts"
"0","select(aapl_rel_dg_numerical, date, contains(""shift""))"
